imports:
    - { resource: tables.yml }
    - { resource: cron_tasks.yml }
    - { resource: notifications.yml }
    - { resource: migrator.yml }
    - { resource: avatars.yml }
    - { resource: feed.yml }
    - { resource: auth_providers.yml }
    - { resource: console.yml }
    - { resource: mimetype_guessers.yml }
    - { resource: passwords.yml }
    - { resource: profilefields.yml }
    - { resource: captcha.yml }
    - { resource: parameters.yml }

services:
    acl.permissions:
        alias: internal.acl.permissions

    auth:
        alias: internal.auth

    avatar.manager:
        alias: internal.avatar.manager

    cache:
        alias: internal.cache

    cache.driver:
        alias: internal.cache.driver

    class_loader:
        alias: internal.class_loader

    class_loader.ext:
        alias: internal.class_loader.ext

    config:
        alias: internal.config

    config.php:
        alias: internal.config.php

    config_text:
        alias: internal.config_text

    content.visibility:
        alias: internal.content.visibility

    controller.helper:
        alias: internal.controller.helper

    controller.resolver:
        alias: internal.controller.resolver

    controller.provider:
        alias: internal.controller.provider

    cron.task_collection:
        alias: internal.cron.task_collection

    cron.manager:
        alias: internal.cron.manager

    cron.lock_db:
        alias: internal.cron.lock_db

    dispatcher:
        alias: internal.dispatcher

    dbal.conn:
        alias: internal.dbal.conn

    dbal.conn.driver:
        alias: internal.dbal.conn.driver

    dbal.tools:
        alias: internal.dbal.tools

    event.subscriber_loader:
        alias: internal.event.subscriber_loader

    event.listener_collection:
        alias: internal.event.listener_collection

    ext.manager:
        alias: internal.ext.manager

    filesystem:
        alias: internal.filesystem

    groupposition.legend:
        alias: internal.groupposition.legend

    groupposition.teampage:
        alias: internal.groupposition.teampage

    http_kernel:
        alias: internal.http_kernel

    hook_finder:
        alias: internal.hook_finder

    kernel_request_subscriber:
        alias: internal.kernel_request_subscriber

    kernel_exception_subscriber:
        alias: internal.kernel_exception_subscriber

    kernel_terminate_subscriber:
        alias: internal.kernel_terminate_subscriber

    log:
        alias: internal.log

    message.form.admin:
        alias: internal.message.form.admin

    message.form.topic:
        alias: internal.message.form.topic

    message.form.user:
        alias: internal.message.form.user

    notification_manager:
        alias: internal.notification_manager

    pagination:
        alias: internal.pagination

    path_helper:
        alias: internal.path_helper

    php_ini:
        alias: internal.php_ini

    plupload:
        alias: internal.plupload

    request:
        alias: internal.request

    symfony_request:
        alias: internal.symfony_request

    template:
        alias: internal.template

    template_context:
        alias: internal.template_context

    user:
        alias: internal.user

    user_loader:
        alias: internal.user_loader

    version_helper:
        alias: internal.version_helper

    viewonline_helper:
        alias: internal.viewonline_helper

    internal.acl.permissions:
        class: phpbb\permissions
        arguments:
            - @dispatcher
            - @user

    internal.auth:
        class: phpbb\auth\auth

    internal.avatar.manager:
        class: phpbb\avatar\manager
        arguments:
            - @config
            - @avatar.driver_collection

    internal.cache:
        class: phpbb\cache\service
        arguments:
             - @cache.driver
             - @config
             - @dbal.conn
             - %core.root_path%
             - %core.php_ext%

    internal.cache.driver:
        class: %cache.driver.class%

    internal.class_loader:
        class: phpbb\class_loader
        arguments:
            - phpbb\
            - %core.root_path%includes/
            - %core.php_ext%
        calls:
            - [register, []]
            - [set_cache, [@cache.driver]]

    internal.class_loader.ext:
        class: phpbb\class_loader
        arguments:
            - \
            - %core.root_path%ext/
            - %core.php_ext%
        calls:
            - [register, []]
            - [set_cache, [@cache.driver]]

    internal.config:
        class: phpbb\config\db
        arguments:
            - @dbal.conn
            - @cache.driver
            - %tables.config%

    internal.config.php:
        synthetic: true

    internal.config_text:
        class: phpbb\config\db_text
        arguments:
            - @dbal.conn
            - %tables.config_text%

    internal.content.visibility:
        class: phpbb\content_visibility
        arguments:
            - @auth
            - @config
            - @dbal.conn
            - @user
            - %core.root_path%
            - %core.php_ext%
            - %tables.forums%
            - %tables.posts%
            - %tables.topics%
            - %tables.users%

    internal.controller.helper:
        class: phpbb\controller\helper
        arguments:
            - @template
            - @user
            - @config
            - @controller.provider
            - @ext.manager
            - @symfony_request
            - %core.root_path%
            - %core.php_ext%

    internal.controller.resolver:
        class: phpbb\controller\resolver
        arguments:
            - @user
            - @service_container
            - %core.root_path%
            - @template

    internal.controller.provider:
        class: phpbb\controller\provider
        calls:
            - [find, [%core.root_path%]]

    internal.cron.task_collection:
        class: phpbb\di\service_collection
        arguments:
            - @service_container
        tags:
            - { name: service_collection, tag: cron.task }

    internal.cron.manager:
        class: phpbb\cron\manager
        arguments:
            - @cron.task_collection
            - %core.root_path%
            - %core.php_ext%

    internal.cron.lock_db:
        class: phpbb\lock\db
        arguments:
            - cron_lock
            - @config
            - @dbal.conn

    internal.dispatcher:
        class: phpbb\event\dispatcher
        arguments:
            - @service_container

    internal.dbal.conn:
        class: phpbb\db\driver\factory
        arguments:
            - @service_container

    internal.dbal.conn.driver:
        class: %dbal.driver.class%
        calls:
            - [sql_connect, [%dbal.dbhost%, %dbal.dbuser%, %dbal.dbpasswd%, %dbal.dbname%, %dbal.dbport%, false, %dbal.new_link%]]

    internal.dbal.tools:
        class: phpbb\db\tools
        arguments:
            - @dbal.conn

    internal.event.subscriber_loader:
        class: phpbb\event\extension_subscriber_loader
        arguments:
            - @dispatcher
            - @event.listener_collection
        calls:
            - [load, []]

    internal.event.listener_collection:
        class: phpbb\di\service_collection
        arguments:
            - @service_container
        tags:
            - { name: service_collection, tag: event.listener }

    internal.ext.manager:
        class: phpbb\extension\manager
        arguments:
            - @service_container
            - @dbal.conn
            - @config
            - @filesystem
            - @user
            - %tables.ext%
            - %core.root_path%
            - %core.php_ext%
            - @cache.driver

    internal.filesystem:
        class: phpbb\filesystem

    internal.groupposition.legend:
        class: phpbb\groupposition\legend
        arguments:
            - @dbal.conn
            - @user

    internal.groupposition.teampage:
        class: phpbb\groupposition\teampage
        arguments:
            - @dbal.conn
            - @user
            - @cache.driver

    internal.http_kernel:
        class: Symfony\Component\HttpKernel\HttpKernel
        arguments:
            - @dispatcher
            - @controller.resolver

    internal.hook_finder:
        class: phpbb\hook\finder
        arguments:
            - %core.root_path%
            - %core.php_ext%
            - @cache.driver

    internal.kernel_request_subscriber:
        class: phpbb\event\kernel_request_subscriber
        arguments:
            - @ext.manager
            - %core.root_path%
            - %core.php_ext%
        tags:
            - { name: kernel.event_subscriber }

    internal.kernel_exception_subscriber:
        class: phpbb\event\kernel_exception_subscriber
        arguments:
            - @template
            - @user
        tags:
            - { name: kernel.event_subscriber }

    internal.kernel_terminate_subscriber:
        class: phpbb\event\kernel_terminate_subscriber
        tags:
            - { name: kernel.event_subscriber }

    internal.log:
        class: phpbb\log\log
        arguments:
            - @dbal.conn
            - @user
            - @auth
            - @dispatcher
            - %core.root_path%
            - %core.adm_relative_path%
            - %core.php_ext%
            - %tables.log%

    internal.message.form.admin:
        class: phpbb\message\admin_form
        arguments:
            - @auth
            - @config
            - @config_text
            - @dbal.conn
            - @user
            - %core.root_path%
            - %core.php_ext%

    internal.message.form.topic:
        class: phpbb\message\topic_form
        arguments:
            - @auth
            - @config
            - @dbal.conn
            - @user
            - %core.root_path%
            - %core.php_ext%

    internal.message.form.user:
        class: phpbb\message\user_form
        arguments:
            - @auth
            - @config
            - @dbal.conn
            - @user
            - %core.root_path%
            - %core.php_ext%

    internal.notification_manager:
        class: phpbb\notification\manager
        arguments:
            - @notification.type_collection
            - @notification.method_collection
            - @service_container
            - @user_loader
            - @config
            - @dbal.conn
            - @cache
            - @user
            - %core.root_path%
            - %core.php_ext%
            - %tables.notification_types%
            - %tables.notifications%
            - %tables.user_notifications%

    internal.pagination:
        class: phpbb\pagination
        arguments:
            - @template
            - @user
            - @controller.helper

    internal.path_helper:
        class: phpbb\path_helper
        arguments:
            - @symfony_request
            - @filesystem
            - @request
            - %core.root_path%
            - %core.php_ext%
            - %core.adm_relative_path%

    internal.php_ini:
        class: phpbb\php\ini

    internal.plupload:
        class: phpbb\plupload\plupload
        arguments:
            - %core.root_path%
            - @config
            - @request
            - @user
            - @php_ini
            - @mimetype.guesser

    internal.request:
        class: phpbb\request\request

    internal.symfony_request:
        class: phpbb\symfony_request
        arguments:
            - @request

    internal.template:
        class: phpbb\template\twig\twig
        arguments:
            - @path_helper
            - @config
            - @user
            - @template_context
            - @ext.manager

    internal.template_context:
        class: phpbb\template\context

    internal.user:
        class: phpbb\user
        arguments:
            - %datetime.class%

    internal.user_loader:
        class: phpbb\user_loader
        arguments:
            - @dbal.conn
            - %core.root_path%
            - %core.php_ext%
            - %tables.users%

    internal.version_helper:
        class: phpbb\version_helper
        scope: prototype
        arguments:
            - @cache
            - @config
            - @user

    internal.viewonline_helper:
        class: phpbb\viewonline_helper
        arguments:
            - @filesystem
